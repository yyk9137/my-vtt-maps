<!doctype html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>VTT Âú∞ÂõæÊü•ÁúãÂô®</title><script type="module">import{gsap as e}from'https://testingcf.jsdelivr.net/npm/gsap/+esm';import{Application as t,Assets as a,Container as n,Graphics as l,Sprite as o,Text as r}from'https://testingcf.jsdelivr.net/npm/pixi.js/+esm';import{default as i}from'https://testingcf.jsdelivr.net/npm/lodash/+esm';var c={42:(e,t)=>{t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a}}},s={};const d=Vue;const u={class:'map-controls'},m={key:0,class:'token-info'},p=(0,d.defineComponent)({__name:'MapCanvas',props:{mapData:{},tokens:{}},emits:['tokenMove','tokenSelect'],setup(i,{emit:c}){const s=i,p=c,v=(0,d.ref)(),f=(0,d.ref)(),g=(0,d.ref)(!0),h=(0,d.ref)(s.mapData.fogOfWar.enabled),b=(0,d.ref)(!s.mapData.globalLight),k=(0,d.ref)(!0),V=(0,d.ref)(null);let E=null,y=null,N=null,x=null,w=null,D=null,C=null,T=null;const S=(0,d.ref)({x:0,y:0,scale:1}),{isLineBlocked:M,calculateFOVShadowCasting:B}=function(){function e(e,a,n,l,o){for(const r of o){if(0===r.sense)continue;if(r.door>0&&1===r.ds)continue;const[o,i,c,s]=r.c;if(t(e,a,n,l,o,i,c,s))return!0}return!1}function t(e,t,a,n,l,o,r,i){const c=(i-o)*(a-e)-(r-l)*(n-t);if(Math.abs(c)<1e-10)return!1;const s=((r-l)*(t-o)-(i-o)*(e-l))/c,d=((a-e)*(t-o)-(n-t)*(e-l))/c;return s>=0&&s<=1&&d>=0&&d<=1}function a(e,t,l,o,r,i,c,s,d,u,m,p,v){if(r<i)return;let f=r;for(let g=o;g<=l;g++){let o=!1;for(let h=-g;h<=0;h++){const b=-g,k=(h-.5)/(b+.5),V=(h+.5)/(b-.5);if(r<V)continue;if(i>k)break;const E=e+h*c+b*s,y=t+h*d+b*u;if(Math.abs(E-e)+Math.abs(y-t)<=l&&v.add(`${E},${y}`),o){if(n(E,y,m,p)){f=V;continue}o=!1,r=f}else n(E,y,m,p)&&g<l&&(o=!0,a(e,t,l,g+1,r,k,c,s,d,u,m,p,v),f=V)}if(o)break}}function n(e,t,a,n){const l=e*n+n/2,o=t*n+n/2;for(const e of a){if(0===e.sense)continue;if(e.door>0&&1===e.ds)continue;const[t,a,n,r]=e.c,i=Math.min(t,n),c=Math.max(t,n),s=Math.min(a,r),d=Math.max(a,r);if(l>=i&&l<=c&&o>=s&&o<=d)return!0}return!1}return{isLineBlocked:e,calculateVisibleArea:function(t,a,n){const l=[],o=t.x,r=t.y,i=t.vision*n;if(i<=0)return l;const c=2*Math.PI/360;for(let t=0;t<360;t++){const s=t*c,d=Math.cos(s),u=Math.sin(s);for(let t=0;t<=i;t+=n/2){const i=o+d*t,c=r+u*t;if(e(o,r,i,c,a))break;const s=Math.floor(i/n),m=Math.floor(c/n);l.some(e=>e.x===s&&e.y===m)||l.push({x:s,y:m})}}return l},calculateFOVShadowCasting:function(e,t,n,l,o){const r=new Set,i=Math.floor(e/o),c=Math.floor(t/o);r.add(`${i},${c}`);const s=[[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1]];for(const[e,t]of s)a(i,c,n,1,1,0,e,t,0,0,l,o,r);return r}}}();function U(){if(!x)return;if(x.clear(),!g.value)return;const{width:e,height:t,grid:a,gridColor:n,gridAlpha:l}=s.mapData;x.lineStyle(1,parseInt(n.replace('#','0x')),l);for(let n=0;n<=e;n+=a)x.moveTo(n,0),x.lineTo(n,t);for(let n=0;n<=t;n+=a)x.moveTo(0,n),x.lineTo(e,n);x.stroke()}function j(){if(D&&(D.removeChildren(),b.value))for(const t of s.mapData.lights){const a=new l,n=t.dim*s.mapData.grid,o=t.bright*s.mapData.grid,r=parseInt(t.tintColor.replace('#','0x'));n>0&&(a.circle(t.x,t.y,n),a.fill({color:r,alpha:.2*t.tintAlpha})),o>0&&(a.circle(t.x,t.y,o),a.fill({color:r,alpha:.5*t.tintAlpha})),a.circle(t.x,t.y,5),a.fill({color:16776960,alpha:.8}),D.addChild(a),e.to(a,{alpha:.7,duration:1+Math.random(),repeat:-1,yoyo:!0,ease:'power1.inOut'})}}function A(){if(!C)return;C.removeChildren();const e=s.tokens||s.mapData.tokens||[];for(const t of e){const e=new l,a=t.width*s.mapData.grid,n=t.x,o=t.y;e.circle(n,o,a/2),e.fill({color:65280,alpha:.6}),e.stroke({width:2,color:16777215});const i=new r({text:t.name,style:{fontSize:12,fill:16777215,stroke:{color:0,width:2}}});i.anchor.set(.5),i.x=n,i.y=o+a/2+10,e.addChild(i),e.eventMode='static',e.cursor='pointer';let c=!1,d=null;e.on('pointerdown',e=>{c=!0;const a=e.global;d={x:a.x-n,y:a.y-o},V.value=t,p('tokenSelect',t)}),e.on('pointerup',()=>{c=!1,d=null}),e.on('pointermove',a=>{if(c&&d){const l=a.global,r=l.x-d.x,i=l.y-d.y;e.x=r-n,e.y=i-o,p('tokenMove',t,r,i)}}),C.addChild(e)}}function O(){if(!T)return;if(T.clear(),!h.value)return;T.rect(0,0,s.mapData.width,s.mapData.height),T.fill({color:0,alpha:.8});const e=s.tokens||s.mapData.tokens||[];for(const t of e){if(t.vision<=0)continue;const e=B(t.x,t.y,t.vision,s.mapData.walls,s.mapData.grid);for(const t of e){const[e,a]=t.split(',').map(Number),n=e*s.mapData.grid,l=a*s.mapData.grid;T.rect(n,l,s.mapData.grid,s.mapData.grid),T.fill({color:0,alpha:-1})}}}function L(){S.value.scale*=1.2,e.to(E.stage.scale,{x:S.value.scale,y:S.value.scale,duration:.3})}function I(){S.value.scale*=.8,e.to(E.stage.scale,{x:S.value.scale,y:S.value.scale,duration:.3})}function R(){S.value={x:0,y:0,scale:1},e.to(E.stage,{x:0,y:0,duration:.5}),e.to(E.stage.scale,{x:1,y:1,duration:.5})}function Y(){g.value=!g.value,U()}function F(){h.value=!h.value,O()}function X(){b.value=!b.value,j()}function W(){k.value=!k.value,N&&(N.visible=k.value)}return(0,d.onMounted)(async()=>{if(!v.value||!f.value)return;E=new t,await E.init({canvas:f.value,width:v.value.clientWidth,height:v.value.clientHeight,backgroundColor:s.mapData.backgroundColor||'#000000',antialias:!0});const r=new n,i=new n,c=new n;D=new n,C=new n;const u=new n,m=new n;if(E.stage.addChild(r),E.stage.addChild(i),E.stage.addChild(c),E.stage.addChild(D),E.stage.addChild(C),E.stage.addChild(u),E.stage.addChild(m),s.mapData.img){const e=await a.load(s.mapData.img);y=new o(e),y.width=s.mapData.width,y.height=s.mapData.height,r.addChild(y)}if(s.mapData.foreground){const e=await a.load(s.mapData.foreground);N=new o(e),N.width=s.mapData.width,N.height=s.mapData.height,u.addChild(N),toastr.info('Â∑≤Âä†ËΩΩÂâçÊôØÂ±Ç (ÈÅÆÊå°Áâ©)')}x=new l,i.addChild(x),U(),w=new l,c.addChild(w),function(){if(!w)return;w.clear();for(const e of s.mapData.walls){const[t,a,n,l]=e.c;let o=16777215,r=.8,i=3;1===e.door?(o=9127187,i=1===e.ds?2:4):2===e.door&&(o=9662683,r=.5),0===e.sense&&(o=4286945,r=.4),w.lineStyle(i,o,r),w.moveTo(t,a),w.lineTo(n,l)}w.stroke()}(),j(),A(),T=new l,m.addChild(T),h.value&&O(),function(){if(!E)return;let t=!1,a={x:0,y:0};E.stage.eventMode='static',E.stage.on('pointerdown',e=>{e.target===E?.stage&&(t=!0,a={x:e.globalX,y:e.globalY})}),E.stage.on('pointerup',()=>{t=!1}),E.stage.on('pointermove',e=>{if(t){const t=e.globalX-a.x,n=e.globalY-a.y;E.stage.x+=t,E.stage.y+=n,a={x:e.globalX,y:e.globalY}}}),f.value?.addEventListener('wheel',t=>{t.preventDefault();const a=t.deltaY>0?.9:1.1,n=S.value.scale*a;n>=.1&&n<=5&&(S.value.scale=n,e.to(E.stage.scale,{x:n,y:n,duration:.2,ease:'power2.out'}))})}();const p=new ResizeObserver(()=>{E&&v.value&&E.renderer.resize(v.value.clientWidth,v.value.clientHeight)});p.observe(v.value),(0,d.onUnmounted)(()=>{p.disconnect()})}),(0,d.watch)(()=>s.tokens,()=>{A(),h.value&&O()},{deep:!0}),(0,d.onUnmounted)(()=>{E?.destroy(!0)}),(e,t)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{class:'map-canvas-container',ref_key:'containerRef',ref:v},[(0,d.createElementVNode)('canvas',{ref_key:'canvasRef',ref:f},null,512),(0,d.createCommentVNode)(' ÊéßÂà∂Èù¢Êùø '),(0,d.createElementVNode)('div',u,[(0,d.createElementVNode)('button',{onClick:L,title:'ÊîæÂ§ß'},[...t[1]||(t[1]=[(0,d.createElementVNode)('span',null,'üîç+',-1)])]),(0,d.createElementVNode)('button',{onClick:I,title:'Áº©Â∞è'},[...t[2]||(t[2]=[(0,d.createElementVNode)('span',null,'üîç-',-1)])]),(0,d.createElementVNode)('button',{onClick:R,title:'ÈáçÁΩÆËßÜÂõæ'},[...t[3]||(t[3]=[(0,d.createElementVNode)('span',null,'üè†',-1)])]),(0,d.createElementVNode)('button',{onClick:Y,title:'ÊòæÁ§∫/ÈöêËóèÁΩëÊ†º'},[(0,d.createElementVNode)('span',null,(0,d.toDisplayString)(g.value?'‚äû':'‚äü'),1)]),(0,d.createElementVNode)('button',{onClick:F,title:'Êàò‰∫âËø∑Èõæ'},[(0,d.createElementVNode)('span',null,(0,d.toDisplayString)(h.value?'üå´Ô∏è':'‚òÄÔ∏è'),1)]),(0,d.createElementVNode)('button',{onClick:X,title:'ÂÖâÁÖßÁ≥ªÁªü'},[(0,d.createElementVNode)('span',null,(0,d.toDisplayString)(b.value?'üí°':'üî¶'),1)]),s.mapData.foreground?((0,d.openBlock)(),(0,d.createElementBlock)('button',{key:0,onClick:W,title:'ÊòæÁ§∫/ÈöêËóèÂâçÊôØÂ±Ç'},[(0,d.createElementVNode)('span',null,(0,d.toDisplayString)(k.value?'üè†':'üèöÔ∏è'),1)])):(0,d.createCommentVNode)('v-if',!0)]),(0,d.createCommentVNode)(' Token ‰ø°ÊÅØÈù¢Êùø '),V.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',m,[(0,d.createElementVNode)('h3',null,(0,d.toDisplayString)(V.value.name),1),(0,d.createElementVNode)('p',null,'‰ΩçÁΩÆ: ('+(0,d.toDisplayString)(Math.floor(V.value.x))+', '+(0,d.toDisplayString)(Math.floor(V.value.y))+')',1),(0,d.createElementVNode)('p',null,'ËßÜÈáé: '+(0,d.toDisplayString)(V.value.vision)+' Ê†º',1),(0,d.createElementVNode)('button',{onClick:t[0]||(t[0]=e=>V.value=null)},'ÂÖ≥Èó≠')])):(0,d.createCommentVNode)('v-if',!0)],512))}});var v=function e(t){var a=s[t];if(void 0!==a)return a.exports;var n=s[t]={exports:{}};return c[t](n,n.exports,e),n.exports}(42);const f=(0,v.A)(p,[['__scopeId','data-v-6d3eac8c']]),g=z,h=g.z.object({x:g.z.number(),y:g.z.number(),dim:g.z.number().default(0),bright:g.z.number().default(0),tintColor:g.z.string().default('#ffffff'),tintAlpha:g.z.number().min(0).max(1).default(.5),animation:g.z.object({type:g.z.string().optional(),speed:g.z.number().optional(),intensity:g.z.number().optional()}).optional()}),b=g.z.object({c:g.z.tuple([g.z.number(),g.z.number(),g.z.number(),g.z.number()]),move:g.z.union([g.z.literal(0),g.z.literal(1)]).default(1),sense:g.z.union([g.z.literal(0),g.z.literal(1)]).default(1),sound:g.z.union([g.z.literal(0),g.z.literal(1)]).default(1),door:g.z.union([g.z.literal(0),g.z.literal(1),g.z.literal(2)]).default(0),ds:g.z.union([g.z.literal(0),g.z.literal(1)]).optional()}),k=g.z.object({id:g.z.string(),name:g.z.string().default('Êú™ÂëΩÂêç'),x:g.z.number(),y:g.z.number(),width:g.z.number().default(1),height:g.z.number().default(1),img:g.z.string().optional(),vision:g.z.number().default(0),dimVision:g.z.number().default(0),rotation:g.z.number().default(0),hidden:g.z.boolean().default(!1),elevation:g.z.number().default(0)}),V=g.z.object({name:g.z.string().default('Êú™ÂëΩÂêçÂú∞Âõæ'),width:g.z.number().positive(),height:g.z.number().positive(),grid:g.z.number().positive().default(100),shiftX:g.z.number().default(0),shiftY:g.z.number().default(0),gridDistance:g.z.number().positive().default(5),gridUnits:g.z.string().default('ft'),padding:g.z.number().default(0),gridColor:g.z.string().default('#000000'),gridAlpha:g.z.number().min(0).max(1).default(.2),globalLight:g.z.boolean().default(!0),darkness:g.z.number().min(0).max(1).default(0),backgroundColor:g.z.string().default('#000000'),img:g.z.string().nullable().optional(),foreground:g.z.string().nullable().optional(),lights:g.z.array(h).default([]),walls:g.z.array(b).default([]),tokens:g.z.array(k).default([]),fogOfWar:g.z.object({enabled:g.z.boolean().default(!1),explored:g.z.array(g.z.array(g.z.boolean())).optional()}).default({enabled:!1})}),E=g.z.object({mapId:g.z.string(),tokens:g.z.array(k),fogExplored:g.z.array(g.z.array(g.z.boolean())).optional(),viewport:g.z.object({x:g.z.number().default(0),y:g.z.number().default(0),scale:g.z.number().default(1)}).default({})});const y={class:'vtt-viewer'},N={key:0,class:'loading'},x={key:1,class:'error'},w={class:'toolbar'},D={class:'toolbar-actions'},C={class:'map-wrapper'},T={key:0,class:'side-panel token-manager'},S={class:'panel-header'},M={class:'panel-content'},B={class:'token-header'},U=['onClick'],j={class:'token-details'},A=['onUpdate:modelValue'],O=['onUpdate:modelValue'],L=['onUpdate:modelValue'],I=['onUpdate:modelValue'],R=['onUpdate:modelValue'],Y={key:1,class:'side-panel map-info'},F={class:'panel-header'},X={class:'panel-content'},W={class:'info-item'},J={class:'info-item'},P={class:'info-item'},H={class:'info-item'},G={class:'info-item'},q={class:'info-item'},K={class:'info-item'},Q=(0,d.defineComponent)({__name:'App',setup(e){const t=(0,d.ref)(!0),a=(0,d.ref)(null),n=(0,d.ref)(null),l=(0,d.ref)(!1),o=(0,d.ref)(!1),r=(0,d.ref)(null),c=(0,d.computed)(()=>r.value?r.value.state.value.tokens:n.value?.tokens||[]);async function s(){t.value=!0,a.value=null;try{const e=getVariables({type:'script',script_id:getScriptId()});if(!e.vtt_map_url&&!e.vtt_map_data)throw new Error('Êú™ÈÖçÁΩÆÂú∞ÂõæÊï∞ÊçÆ„ÄÇËØ∑Âú®ËÑöÊú¨ÂèòÈáè‰∏≠ËÆæÁΩÆ vtt_map_url Êàñ vtt_map_data');let t;if(e.vtt_map_url){const a=await fetch(e.vtt_map_url);t=await a.json()}else t=e.vtt_map_data;const a=V.parse(t);n.value=a,r.value=function(e){const t=t=>{try{const a=`vtt_map_${e}`,n=i.cloneDeep(t);replaceVariables({[a]:n},{type:'chat'})}catch(e){console.error('‰øùÂ≠òÂú∞ÂõæÁä∂ÊÄÅÂ§±Ë¥•:',e)}},a=(0,d.ref)((()=>{try{const t=getVariables({type:'chat'}),a=`vtt_map_${e}`;if(t[a])return E.parse(t[a])}catch(e){console.warn('Âä†ËΩΩÂú∞ÂõæÁä∂ÊÄÅÂ§±Ë¥•:',e)}return{mapId:e,tokens:[],viewport:{x:0,y:0,scale:1}}})()),n=i.debounce(e=>{t(e)},1e3);return(0,d.watch)(a,e=>{n(e)},{deep:!0}),{state:a,updateTokenPosition:(e,t,n)=>{const l=a.value.tokens.find(t=>t.id===e);l&&(l.x=t,l.y=n)},addToken:e=>{a.value.tokens.find(t=>t.id===e.id)||a.value.tokens.push(e)},removeToken:e=>{const t=a.value.tokens.findIndex(t=>t.id===e);-1!==t&&a.value.tokens.splice(t,1)},updateViewport:(e,t,n)=>{a.value.viewport={x:e,y:t,scale:n}},markExplored:(e,t)=>{a.value.fogExplored||(a.value.fogExplored=[]),a.value.fogExplored[t]||(a.value.fogExplored[t]=[]),a.value.fogExplored[t][e]=!0},isExplored:(e,t)=>a.value.fogExplored?.[t]?.[e]??!1,saveState:()=>t(a.value)}}(a.name),0===r.value.state.value.tokens.length&&a.tokens.length>0&&a.tokens.forEach(e=>{r.value?.addToken(e)}),toastr.success(`Âú∞Âõæ "${a.name}" Âä†ËΩΩÊàêÂäü`)}catch(e){a.value=e instanceof Error?e.message:String(e),toastr.error('Âú∞ÂõæÂä†ËΩΩÂ§±Ë¥•: '+a.value)}finally{t.value=!1}}function u(e,t,a){r.value?.updateTokenPosition(e.id,t,a)}function m(e){console.log('ÈÄâ‰∏≠ Token:',e)}function p(){if(!r.value||!n.value)return;const e=k.parse({id:`token_${Date.now()}`,name:`Token ${c.value.length+1}`,x:n.value.width/2,y:n.value.height/2,width:1,height:1,vision:12});r.value.addToken(e),toastr.success(`Ê∑ªÂä†‰∫ÜÊñ∞ÁöÑ Token: ${e.name}`)}function v(){if(!r.value)return;const e=r.value.state.value,t=JSON.stringify(e,null,2);navigator.clipboard.writeText(t).then(()=>{toastr.success('Áä∂ÊÄÅÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø')}).catch(()=>{const e=new Blob([t],{type:'application/json'}),a=URL.createObjectURL(e),l=document.createElement('a');l.href=a,l.download=`${n.value?.name}_state.json`,l.click(),URL.revokeObjectURL(a)})}function g(){const e=prompt('ËØ∑Á≤òË¥¥Âú∞ÂõæÁä∂ÊÄÅ JSON:');if(e)try{const t=JSON.parse(e);replaceVariables({[`vtt_map_${n.value?.name}`]:t},{type:'chat'}),toastr.success('Áä∂ÊÄÅÂØºÂÖ•ÊàêÂäü,Ê≠£Âú®ÈáçÊñ∞Âä†ËΩΩ...'),setTimeout(()=>location.reload(),1e3)}catch(e){toastr.error('ÂØºÂÖ•Â§±Ë¥•: '+(e instanceof Error?e.message:String(e)))}}return(0,d.onMounted)(()=>{s()}),(e,i)=>((0,d.openBlock)(),(0,d.createElementBlock)('div',y,[t.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',N,[...i[4]||(i[4]=[(0,d.createElementVNode)('div',{class:'spinner'},null,-1),(0,d.createElementVNode)('p',null,'Âä†ËΩΩÂú∞Âõæ‰∏≠...',-1)])])):a.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',x,[i[5]||(i[5]=(0,d.createElementVNode)('h2',null,'‚ùå Âä†ËΩΩÂ§±Ë¥•',-1)),(0,d.createElementVNode)('pre',null,(0,d.toDisplayString)(a.value),1),(0,d.createElementVNode)('button',{onClick:s},'ÈáçËØï')])):n.value?((0,d.openBlock)(),(0,d.createElementBlock)(d.Fragment,{key:2},[(0,d.createCommentVNode)(' È°∂ÈÉ®Â∑•ÂÖ∑Ê†è '),(0,d.createElementVNode)('div',w,[(0,d.createElementVNode)('h2',null,(0,d.toDisplayString)(n.value.name),1),(0,d.createElementVNode)('div',D,[(0,d.createElementVNode)('button',{onClick:i[0]||(i[0]=e=>l.value=!l.value)},'üé≠ Token ÁÆ°ÁêÜ'),(0,d.createElementVNode)('button',{onClick:i[1]||(i[1]=e=>o.value=!o.value)},'‚ÑπÔ∏è Âú∞Âõæ‰ø°ÊÅØ'),(0,d.createElementVNode)('button',{onClick:v},'üíæ ÂØºÂá∫Áä∂ÊÄÅ'),(0,d.createElementVNode)('button',{onClick:g},'üìÅ ÂØºÂÖ•Áä∂ÊÄÅ')])]),(0,d.createCommentVNode)(' Âú∞ÂõæÁîªÂ∏É '),(0,d.createElementVNode)('div',C,[(0,d.createVNode)(f,{'map-data':n.value,tokens:c.value,onTokenMove:u,onTokenSelect:m},null,8,['map-data','tokens'])]),(0,d.createCommentVNode)(' Token ÁÆ°ÁêÜÈù¢Êùø '),l.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',T,[(0,d.createElementVNode)('div',S,[i[6]||(i[6]=(0,d.createElementVNode)('h3',null,'Token ÁÆ°ÁêÜ',-1)),(0,d.createElementVNode)('button',{onClick:i[2]||(i[2]=e=>l.value=!1)},'‚úñ')]),(0,d.createElementVNode)('div',M,[(0,d.createElementVNode)('button',{onClick:p,class:'add-token-btn'},'‚ûï Ê∑ªÂä† Token'),((0,d.openBlock)(!0),(0,d.createElementBlock)(d.Fragment,null,(0,d.renderList)(c.value,e=>((0,d.openBlock)(),(0,d.createElementBlock)('div',{key:e.id,class:'token-item'},[(0,d.createElementVNode)('div',B,[(0,d.createElementVNode)('strong',null,(0,d.toDisplayString)(e.name),1),(0,d.createElementVNode)('button',{onClick:t=>{return a=e.id,void(r.value&&confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ Token Âêó?')&&(r.value.removeToken(a),toastr.success('Token Â∑≤Âà†Èô§')));var a},class:'delete-btn'},'üóëÔ∏è',8,U)]),(0,d.createElementVNode)('div',j,[(0,d.createElementVNode)('label',null,[i[7]||(i[7]=(0,d.createTextVNode)(' ÂêçÁß∞: ',-1)),(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':t=>e.name=t,type:'text'},null,8,A),[[d.vModelText,e.name]])]),(0,d.createElementVNode)('label',null,[i[8]||(i[8]=(0,d.createTextVNode)(' X: ',-1)),(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':t=>e.x=t,type:'number',step:'10'},null,8,O),[[d.vModelText,e.x,void 0,{number:!0}]])]),(0,d.createElementVNode)('label',null,[i[9]||(i[9]=(0,d.createTextVNode)(' Y: ',-1)),(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':t=>e.y=t,type:'number',step:'10'},null,8,L),[[d.vModelText,e.y,void 0,{number:!0}]])]),(0,d.createElementVNode)('label',null,[i[10]||(i[10]=(0,d.createTextVNode)(' ËßÜÈáéËåÉÂõ¥: ',-1)),(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':t=>e.vision=t,type:'number',min:'0',max:'100'},null,8,I),[[d.vModelText,e.vision,void 0,{number:!0}]])]),(0,d.createElementVNode)('label',null,[i[11]||(i[11]=(0,d.createTextVNode)(' Â∞∫ÂØ∏: ',-1)),(0,d.withDirectives)((0,d.createElementVNode)('input',{'onUpdate:modelValue':t=>e.width=t,type:'number',min:'1',max:'10'},null,8,R),[[d.vModelText,e.width,void 0,{number:!0}]])])])]))),128))])])):(0,d.createCommentVNode)('v-if',!0),(0,d.createCommentVNode)(' Âú∞Âõæ‰ø°ÊÅØÈù¢Êùø '),o.value?((0,d.openBlock)(),(0,d.createElementBlock)('div',Y,[(0,d.createElementVNode)('div',F,[i[12]||(i[12]=(0,d.createElementVNode)('h3',null,'Âú∞Âõæ‰ø°ÊÅØ',-1)),(0,d.createElementVNode)('button',{onClick:i[3]||(i[3]=e=>o.value=!1)},'‚úñ')]),(0,d.createElementVNode)('div',X,[(0,d.createElementVNode)('div',W,[i[13]||(i[13]=(0,d.createElementVNode)('label',null,'Âú∞ÂõæÂêçÁß∞:',-1)),(0,d.createElementVNode)('span',null,(0,d.toDisplayString)(n.value.name),1)]),(0,d.createElementVNode)('div',J,[i[14]||(i[14]=(0,d.createElementVNode)('label',null,'Â∞∫ÂØ∏:',-1)),(0,d.createElementVNode)('span',null,(0,d.toDisplayString)(n.value.width)+' √ó '+(0,d.toDisplayString)(n.value.height)+' px',1)]),(0,d.createElementVNode)('div',P,[i[15]||(i[15]=(0,d.createElementVNode)('label',null,'ÁΩëÊ†º:',-1)),(0,d.createElementVNode)('span',null,(0,d.toDisplayString)(n.value.grid)+' px ('+(0,d.toDisplayString)(n.value.gridDistance)+' '+(0,d.toDisplayString)(n.value.gridUnits)+')',1)]),(0,d.createElementVNode)('div',H,[i[16]||(i[16]=(0,d.createElementVNode)('label',null,'ÂÖâÊ∫êÊï∞Èáè:',-1)),(0,d.createElementVNode)('span',null,(0,d.toDisplayString)(n.value.lights.length),1)]),(0,d.createElementVNode)('div',G,[i[17]||(i[17]=(0,d.createElementVNode)('label',null,'Â¢ôÂ£ÅÊï∞Èáè:',-1)),(0,d.createElementVNode)('span',null,(0,d.toDisplayString)(n.value.walls.length),1)]),(0,d.createElementVNode)('div',q,[i[18]||(i[18]=(0,d.createElementVNode)('label',null,'ÂÖ®Â±ÄÂÖâÁÖß:',-1)),(0,d.createElementVNode)('span',null,(0,d.toDisplayString)(n.value.globalLight?'ÊòØ':'Âê¶'),1)]),(0,d.createElementVNode)('div',K,[i[19]||(i[19]=(0,d.createElementVNode)('label',null,'ÈªëÊöóÁ≠âÁ∫ß:',-1)),(0,d.createElementVNode)('span',null,(0,d.toDisplayString)((100*n.value.darkness).toFixed(0))+'%',1)])])])):(0,d.createCommentVNode)('v-if',!0)],64)):(0,d.createCommentVNode)('v-if',!0)]))}}),Z=(0,v.A)(Q,[['__scopeId','data-v-712ceb6a']]);$(()=>{(0,d.createApp)(Z).mount('#app'),toastr.success('VTT Âú∞ÂõæÊü•ÁúãÂô®Â∑≤Âä†ËΩΩ')}),$(window).on('pagehide',()=>{toastr.info('VTT Âú∞ÂõæÊü•ÁúãÂô®Â∑≤Âç∏ËΩΩ')});</script><style>.map-canvas-container[data-v-6d3eac8c]{position:relative;width:100%;height:100%;overflow:hidden;background:#1a1a1a}canvas[data-v-6d3eac8c]{display:block;width:100%;height:100%}.map-controls[data-v-6d3eac8c]{position:absolute;top:10px;right:10px;display:flex;flex-direction:column;gap:5px;z-index:10}.map-controls button[data-v-6d3eac8c]{width:40px;height:40px;border:none;background:rgba(0,0,0,0.7);color:white;border-radius:5px;cursor:pointer;font-size:18px;transition:background 0.2s}.map-controls button[data-v-6d3eac8c]:hover{background:rgba(0,0,0,0.9)}.token-info[data-v-6d3eac8c]{position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.8);color:white;padding:15px;border-radius:8px;min-width:200px;z-index:10}.token-info h3[data-v-6d3eac8c]{margin:0 0 10px 0;font-size:16px}.token-info p[data-v-6d3eac8c]{margin:5px 0;font-size:14px}.token-info button[data-v-6d3eac8c]{margin-top:10px;padding:5px 10px;background:#4caf50;border:none;color:white;border-radius:4px;cursor:pointer}.token-info button[data-v-6d3eac8c]:hover{background:#45a049}

.vtt-viewer[data-v-712ceb6a]{width:100%;height:100vh;display:flex;flex-direction:column;background:#1a1a1a;color:white;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}.loading[data-v-712ceb6a],.error[data-v-712ceb6a]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:20px}.spinner[data-v-712ceb6a]{width:50px;height:50px;border:4px solid rgba(255,255,255,0.3);border-top-color:white;border-radius:50%;animation:spin-712ceb6a 1s linear infinite}@keyframes spin-712ceb6a{to{transform:rotate(360deg)}}.error pre[data-v-712ceb6a]{background:rgba(255,0,0,0.2);padding:15px;border-radius:5px;max-width:600px}.error button[data-v-712ceb6a]{padding:10px 20px;background:#4caf50;border:none;color:white;border-radius:5px;cursor:pointer}.toolbar[data-v-712ceb6a]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:rgba(0,0,0,0.8);border-bottom:2px solid #333}.toolbar h2[data-v-712ceb6a]{margin:0;font-size:20px}.toolbar-actions[data-v-712ceb6a]{display:flex;gap:10px}.toolbar-actions button[data-v-712ceb6a]{padding:8px 15px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.3);color:white;border-radius:5px;cursor:pointer;transition:background 0.2s}.toolbar-actions button[data-v-712ceb6a]:hover{background:rgba(255,255,255,0.2)}.map-wrapper[data-v-712ceb6a]{flex:1;position:relative}.side-panel[data-v-712ceb6a]{position:absolute;top:60px;right:10px;width:300px;max-height:calc(100vh - 80px);background:rgba(0,0,0,0.9);border:1px solid #333;border-radius:8px;overflow:hidden;display:flex;flex-direction:column;z-index:100}.panel-header[data-v-712ceb6a]{display:flex;justify-content:space-between;align-items:center;padding:15px;background:rgba(255,255,255,0.1);border-bottom:1px solid #333}.panel-header h3[data-v-712ceb6a]{margin:0;font-size:16px}.panel-header button[data-v-712ceb6a]{background:none;border:none;color:white;font-size:18px;cursor:pointer}.panel-content[data-v-712ceb6a]{flex:1;overflow-y:auto;padding:15px}.add-token-btn[data-v-712ceb6a]{width:100%;padding:10px;background:#4caf50;border:none;color:white;border-radius:5px;cursor:pointer;margin-bottom:15px}.token-item[data-v-712ceb6a]{background:rgba(255,255,255,0.05);padding:10px;border-radius:5px;margin-bottom:10px}.token-header[data-v-712ceb6a]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.delete-btn[data-v-712ceb6a]{background:rgba(255,0,0,0.3);border:none;color:white;padding:4px 8px;border-radius:3px;cursor:pointer}.token-details[data-v-712ceb6a]{display:flex;flex-direction:column;gap:8px}.token-details label[data-v-712ceb6a]{display:flex;justify-content:space-between;align-items:center;font-size:14px}.token-details input[data-v-712ceb6a]{width:120px;padding:4px 8px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.3);color:white;border-radius:3px}.info-item[data-v-712ceb6a]{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.1)}.info-item label[data-v-712ceb6a]{font-weight:bold}

</style></head><body><div id="app"></div></body></html>